<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/avatar.png"/>
	<link rel="shortcut icon" href="/img/avatar.png">
	
			    <title>
    wuzhenren's blog
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="" />
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/sunset.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src=""></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo"></a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Spring-Boot/">Spring Boot</a></li><li><a class="category-link" href="/categories/Spring-Boot/%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%BF%97/">工作日志</a></li><li><a class="category-link" href="/categories/leetcode/">leetcode</a></li><li><a class="category-link" href="/categories/ustc/">ustc</a></li><li><a class="category-link" href="/categories/ustc/%E4%B8%AA%E4%BA%BA%E7%94%9F%E6%B4%BB/">个人生活</a></li><li><a class="category-link" href="/categories/%E4%B8%AA%E4%BA%BA%E7%94%9F%E6%B4%BB/">个人生活</a></li><li><a class="category-link" href="/categories/%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%BF%97/">工作日志</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/motto/" title="motto">
		                motto
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/wzr1005" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="zhihu" href="https://www.zhihu.com/people/wu-zhen-ren" target="_blank" rel="noopener">
                            <i class="icon fa fa-zhihu"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(https://tva1.sinaimg.cn/large/008i3skNgy1gu37mgppw7j61900u0aeb02.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >9月3日</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <p>​    </p>
<p>我刚来的时候四个人，马上房间就是我一个人住了。。</p>
<p><span style="color:red;background:背景颜色;font-size:文字大小;font-family:字体;">你要改色的文字</span></p>
<p>前端传的日期格式，与数据库2021-08-28 12:00:00不匹配的问题，</p>
<p><strong>将mysql-connect的依赖改成5.1.47解决</strong></p>
<p>破案了，criteria.getSearchType()==”all”一直不成立，因为字符串常量在常量池，比较的是地址，</p>
<p>比较String内容是否相等应该用equal</p>
<p>有文件提交不了，可以git add -A 大写</p>
<h2 id="Redis缓存与数据一致性问题"><a href="#Redis缓存与数据一致性问题" class="headerlink" title="Redis缓存与数据一致性问题"></a>Redis缓存与数据一致性问题</h2><p>如何更新缓存中的数据，也就是说。</p>
<ol>
<li>我是先更新缓存中的数据再更新数据库的数据；</li>
<li>还是先修改数据库中的数据再更新缓存中的数据</li>
</ol>
<p>这就是我们经常会在面试遇到的问题，数据库的数据和缓存中的数据如何达到一致性？</p>
<p>首先，可以肯定的是，redis中的数据和数据库中的数据不可能保证事务性达到统一的，这个是毫无疑问的，</p>
<p>所以在实际应用中，我们都是基于当前的场景进行权衡降低出现不一致问题的出现概率。</p>
<p>此外我们还可以通过给缓存设置一个过期时间，无论以上的两种操作使用哪一种，都能够在理论上保持数据的最终一致性。</p>
<p><span style="color:red;background: ;font-family:Times New Roman;">在写数据的时候，都以数据库为主，先把数据库数据写入后，再更新缓存</span></p>
<p>如果失败了，那么原来的缓存无论是否存在，那么只要经过过期时间，那么读操作时，</p>
<p>就会重新从数据库中读出，然后同步到缓存中。</p>
<p>我们接着讨论以上两种操作:</p>
<p>1.先删除缓存，再更新数据库。在大型分布式系统环境下，就需要考虑并发时的问题了。</p>
<p><span style="color:red">这种处理方式，可能会有如下情况:</span></p>
<p>线程A，写入(更新)数据时，先删除缓存后，</p>
<p>同时，有一个线程B，此时去读数据，先去缓存中读,此时刚被线程A删除了，</p>
<p>于是去数据库读还未被线程A更新的数据，这时候就会读到脏数据了。</p>
<p><span style="color:red">也就是说读到了A还没写入的数据</span></p>
<p>紧接着，线程B会把脏数据写入缓存，而线程A会把更新后的数据写入数据库。导致缓存与数据不一致。</p>
<p>参考方式: 给缓存设置过期时间，让B读到的那个脏数据过段时间自己消失，否则会一直读到脏数据。</p>
<p>处理方式:网上有几种处理方式:</p>
<p><span style= color:red >1. 双删策略</span></p>
<p>先删除缓存。</p>
<p>写入数据库，休眠1秒，执行删除缓存(目的是把1秒内产生的脏数据重新从缓存中删除)</p>
<p>缺点: 需要把控好休眠时间，同时时间可能会过长，当请求量很大时，再短的时间也会造成响应过长。</p>
<p>其次这个请求时间是跟读操作时，会产生脏数据的时间有关的。</p>
<p>B去读数据库的时候，读到的是1秒后写入到数据库的数据，</p>
<p><span style= color:red > </span></p>
<p>当线程B去读数据库时，可能读到的是还未更新到从库的脏数据，因为当我们休眠是，不仅需要<span style= color:red > 考虑读操作的完整执行</span>完的时间，还需要加<span style= color:red > 主从复制这段时间的几百Ms。</span></p>
<p><span style=color:red>2. 先修改数据库中的数据再更新缓存中的数据</span></p>
<p>同样存在这种情况，线程A查询操作(读操作)，线程B更新操作。</p>
<p>线程A先执行，线程B后执行。线程A先查询时，去缓存读取时，缓存失效了，</p>
<p>此时继续去数据库读，</p>
<p>考虑线程执行的随机性，</p>
<p>这时候线程B修改数据库后，把数据写入缓存了。</p>
<p>在此之后，线程A才执行把数据写入缓存中，此时缓存中的任然是脏数据。</p>
<p>分为以下几个步骤:<br>（1）缓存刚好失效<br>（2）请求A查询数据库，得一个旧值<br>（3）<span style= color:red > 请求B将新值写入数据库</span><br>（4）请求B删除缓存<br>（5）请求A将查到的旧值写入缓存</p>
<p>发生上述情况有一个先天性条件，<span style=color:red>就是步骤（3）的写数据库操作比步骤（2）的读数据库操作耗时更短</span>，才有可能使得步骤（4）先于步骤（5）。</p>
<p>可是，大家想想，数据库的读操作的速度远快于写操作的（不然做读写分离干嘛，做读写分离的意义就是因为读操作比较快，耗资源少）</p>
<p>因此步骤（3）耗时比步骤（2）更短，这一情形很难出现。</p>
<hr>
<p>join()的作用是：“等待该线程终止”</p>
<p>这里需要理解的就是该线程是指的<span style=color:red>主线程等待子线程的终止</span></p>
<p><strong>主线程需要等待子线程执行完成之后再结束</strong>，这个时候就要用到join()方法</p>
<p>在很多情况下，主线程生成并起动了子线程，</p>
<p>如果子线程里要进行大量的耗时的运算，主线程往往将于子线程之前结束，</p>
<p>但是如果主线程处理完其他的事务后，需要用到子线程的处理结果，</p>
<p><strong>③yield():暂停当前正在执行的线程对象，并执行其他线程。</strong></p>
<p>Thread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。</p>
<p><strong>yield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。</strong></p>
<p>因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。</p>
<p><span style=color:red>即 自己开个小差，让别人执行一下马上就自己执行</span></p>
<p>但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。</p>
<p>结论：yield()从未导致线程转到等待/睡眠/阻塞状态。是给了别人处理机资源</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.opsForHash().put(key, item, value);</span><br></pre></td></tr></table></figure>

<p>put有三个参数，分别是</p>
<p>put(H key, HK hashKey, HV value)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void put(H key,</span><br><span class="line">         HK hashKey,</span><br><span class="line">         HV value)</span><br></pre></td></tr></table></figure>

<p>Set the <code>value</code> of a hash <code>hashKey</code>.</p>
<ul>
<li><p><strong>Parameters:</strong></p>
<p><code>key</code> - must not be null.</p>
<p><code>hashKey</code> - must not be null.</p>
<p><code>value</code> -</p>
</li>
</ul>
<p><strong>Redis hash 是一个string类型的field和value的映射表，hash特别适合用于存储对象。<br>Redis 中每个 hash 可以存储 2^32 - 1 键值对（40多亿）。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.opsForHash().put(&quot;user&quot;,&quot;age&quot;,18);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.opsForHash().put(&quot;user&quot;,&quot;name&quot;,&quot;Lisa&quot;);</span><br></pre></td></tr></table></figure>

<p>观察以上用法，和直接命令行 hset user age  18无异</p>
<p>相当于是对象是user，age是属性，18是属性值</p>
<p>/**<br>     * 获取hashKey对应的所有键值<br>          *<br>          * @param key 键<br>               * @return 对应的多个键值<br>               */<br>            public Map&lt;Object, Object&gt; hmget(String key) {<br>        return redisTemplate.opsForHash().entries(key);</p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://example.com/2021/09/03/9%E6%9C%883%E6%97%A5/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://example.com/2021/09/03/9%E6%9C%883%E6%97%A5/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a target="_blank" rel="noopener" href="http://baidu.com " style="border-bottom: none;">wzr1005</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
